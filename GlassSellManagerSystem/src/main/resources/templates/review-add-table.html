<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>复查信息表格页面</title>
    <meta content="webkit" name="renderer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"
          name="viewport"/>
    <link th:href="@{/css/font.css}" rel="stylesheet">
    <link th:href="@{/css/xadmin.css}" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
    <script charset="utf-8" th:src="@{/lib/layui/layui.js}"></script>
    <script th:src="@{/js/xadmin.js}" type="text/javascript"></script>
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="layui-main" style="text-align: center">
    <div id="LAY_preview">
        <div class="layui-form layui-border-box layui-table-view">
            <div class="layui-table-box layui-inline">
                <div class="layui-table-body">
                    <form class="layui-form layui-form-pane" action="">
                        <input hidden="hidden" value="" name="review_customerId" th:value="${customer.customer_id}">
                        <input hidden="hidden" value="" name="review_customerName" th:value="${customer.customer_id}">
                        <input hidden="hidden" value="" name="review_userId" th:value="${session.user.id}">
                        <input hidden="hidden" value="" name="review_userName" th:value="${session.user.name}">
                        <table border="0" cellpadding="0" cellspacing="0" class="layui-table"
                               style="text-align: center;width: 808px;">
                            <tbody>
                            <tr>
                                <td colspan="10">视力美会员档案</td>
                            </tr>
                            <tr>
                                <td>会员卡号</td>
                                <td colspan="6" th:text="${customer.customer_id}"></td>
                                <td>生日</td>
                                <td colspan="2" th:text="${customer.customer_birthday}"></td>
                            </tr>
                            <tr>
                                <td>姓名</td>
                                <td th:text="${customer.customer_name}"></td>
                                <td>性别</td>
                                <td th:text="${customer.customer_sex}"></td>
                                <td>年龄</td>
                                <td th:text="${age}"></td>
                                <td>所在学校</td>
                                <td colspan="3" th:text="${customer.customer_schoolName}"></td>
                            </tr>
                            <tr>
                                <td>戴镜史</td>
                                <td th:text="${customer.customer_history}"></td>
                                <td>瞳距</td>
                                <td colspan="3" th:text="'左眼瞳距：'+${customer.customer_PDLeft}+'，右眼瞳距：'+${customer.customer_PDRight}"></td>
                                <td>家庭住址</td>
                                <td colspan="3" th:text="${customer.customer_address}"></td>
                            </tr>
                            <tr>
                                <td colspan="3">裸眼视力</td>
                                <td colspan="3">矫正视力</td>
                                <td rowspan="2">配镜参数</td>
                                <td colspan="3" rowspan="2" th:text="${customer.customer_glassesDegree}"></td>
                            </tr>
                            <tr>
                                <td th:text="'R:'+${customer.customer_visionRight}"></td>
                                <td colspan="2" th:text="'L:'+${customer.customer_visionLeft}"></td>
                                <td colspan="2">5.0</td>
                                <td>5.0</td>
                            </tr>
                            <tr>
                                <td>配镜日期</td>
                                <td colspan="2" th:text="${customer.customer_createOrderDate}"></td>
                                <td>镜架型号</td>
                                <td colspan="2" th:text="${customer.customer_framesType}"></td>
                                <td>镜片型号</td>
                                <td colspan="3" th:text="${customer.customer_glassesType}"></td>
                            </tr>
                            <tr>
                                <td>取镜日期</td>
                                <td colspan="2" th:text="${customer.customer_getOrderDate}"></td>
                                <td>联系方式</td>
                                <td>母亲</td>
                                <td colspan="2" th:text="${customer.customer_parentMomPhoneNumber}"></td>
                                <td>父亲</td>
                                <td colspan="2" th:text="${customer.customer_parentDadPhoneNumber}"></td>
                            </tr>
                            <tr>
                                <td>验光师编号</td>
                                <td colspan="2" th:text="${customer.customer_userId}"></td>
                                <td>验光师</td>
                                <td colspan="2" th:text="${customer.customer_userName}"></td>
                                <td>身高</td>
                                <td th:text="${customer.customer_height}"></td>
                                <td>体重</td>
                                <td th:text="${customer.customer_weight}"></td>
                            </tr>
                            </tbody>
                        </table>
                        <table border="0" cellpadding="0" cellspacing="0" class="layui-table"
                               style="text-align: center;width: 800px;">
                            <tbody>
                            <tr>
                                <td colspan="12">复查记录</td>
                            </tr>
                            <tr>
                                <td>日期</td>
                                <td colspan="4">
                                    <input autocomplete="off" class="layui-input" id="date" name="review_createDate" type="text"
                                           lay-verify="review_createDate" placeholder="请输入登记日期" style="border: none;width: 320px;">
                                </td>
                                <td>眼位</td>
                                <td colspan="2">
                                    <input type="text" name="review_positionOfEye" lay-verify="review_positionOfEye" style="width: 80px;border: none">
                                </td>
                                <td>AC/A值</td>
                                <td colspan="2">
                                    <input type="text" name="review_ACA" lay-verify="review_ACA" style="width: 80px;border: none">
                                </td>
                                <td colspan="2" rowspan="6">
                                    <button class="layui-btn layui-btn-sm" lay-filter="submit" lay-submit="" title="添加记录" >
                                        <i class="layui-icon">&#xe654;</i></button><br /><br />
                                    <button type="reset" class="layui-btn layui-btn-sm" title="重置表格">
                                        <i class="layui-icon">&#xe666;</i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td rowspan="3">视力参数</td>
                                <td colspan="2">裸眼视力</td>
                                <td colspan="2">矫正视力</td>
                                <td rowspan="5">护眼方案</td>
                                <td rowspan="5" colspan="4" style="padding: 0;">
                                    <textarea class="layui-textarea" style="border: 0;margin: 0" id="textarea" onblur="valueMessage()"></textarea>
                                    <input type="text" hidden="hidden" name="review_suggest" id="review_suggest" value="" lay-verify="review_suggest">
                                </td>
                            </tr>
                            <tr>
                                <td>R</td>
                                <td>L</td>
                                <td>R</td>
                                <td>L</td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" name="review_UCVARight" id="review_UCVARight" lay-verify="review_UCVARight" style="width: 80px;border: none">
                                </td>
                                <td>
                                    <input type="text" name="review_UCVALeft" id="review_UCVALeft" lay-verify="review_UCVALeft" style="width: 80px;border: none">
                                </td>
                                <td>
                                    <input type="text" name="review_CVARight" id="review_CVARight" lay-verify="review_CVARight" style="width: 80px;border: none">
                                </td>
                                <td>
                                    <input type="text" name="review_CVALeft" id="review_CVALeft" lay-verify="review_CVALeft" style="width: 80px;border: none">
                                </td>
                            </tr>
                            <tr>
                                <td>R</td>
                                <td colspan="4">
                                    <input type="text" name="review_Right" id="review_Right" lay-verify="review_Right" style="width: 320px;border: none">
                                </td>
                            </tr>
                            <tr>
                                <td>L</td>
                                <td colspan="4">
                                    <input type="text" name="review_Left" id="review_Left" lay-verify="review_Left" style="width: 320px;border: none">
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    function valueMessage() {
        var text = $('#textarea').val();
        $('#review_suggest').val(text);
    }
</script>
<script>
    layui.use(['form','laydate'], function () {
        form = layui.form;
        var laydate = layui.laydate;
        //执行一个laydate实例
        laydate.render({
            elem: '#date' //指定元素
        });
        form.verify({
            review_createDate:[/^.{5,15}$/,'请选择日期'],
            review_positionOfEye:[/^.{2,20}$/,'请输入眼位'],
            review_ACA:[/^.{2,20}$/,'请输入AC/A值'],
            review_suggest:[/^.{3,100}$/,'请输入护眼方案最长50字'],
            review_UCVARight:[/^(-?\d+)(\.\d+)?$/,'请输入右眼裸眼视力'],
            review_UCVALeft:[/^(-?\d+)(\.\d+)?$/,'请输入左眼裸眼视力'],
            review_CVARight:[/^(-?\d+)(\.\d+)?$/,'请输入右眼矫正视力'],
            review_CVALeft:[/^(-?\d+)(\.\d+)?$/,'请输入左眼矫正视力'],
            review_Right:[/^.{3,20}$/,'请输入右眼度数参数'],
            review_Left:[/^.{3,20}$/,'请输入左眼度数参数']
        });

        form.on('submit(submit)',
            function (data) {

                console.log(data);
                addCustomerReview(data.field);
                return false;
            });
    });


    function addCustomerReview(data) {
        $.ajax({
            type: "POST",
            // dataType:"json",
            data: data,
            url: "http://localhost:9911/user/customer/vip/addReview",
            success: function (data) {
                layer.alert("登记成功", {
                        icon: 6
                    },
                    function () {
                        // 获得frame索引
                        var index = parent.layer.getFrameIndex(window.name);
                        //关闭当前frame
                        parent.layer.close(index);
                    });
            },
            error: function (message) {
                layer.alert("登记失败", {
                        icon: 5
                    },
                    function () {
                        // 获得frame索引
                        var index = parent.layer.getFrameIndex(window.name);
                        //关闭当前frame
                        parent.layer.close(index);
                    });
            }
        })
    }
</script>
</html>